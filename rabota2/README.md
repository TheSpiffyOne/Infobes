# Контрольная работа 2
*Преловский Егор Вячеславович*
*Группа УИБО-13-24*
  
## Задание 1. SQL-injection и логин с административными правами
При вводе значка ' в поле логин и случаного пароля получаем странный ответ.
<img width="629" height="658" alt="image" src="https://github.com/user-attachments/assets/ba690a28-2f1e-4077-8c27-8d13b427e96a" />
<img width="970" height="958" alt="image" src="https://github.com/user-attachments/assets/bde1188a-cdad-4b90-be55-64b31fc0edc2" />

Ошибка показывет что проблема с базой данной а не с введнном паролем
Это означает что база данных пользователей реализована с уязвимостями

Ввод ' OR true;-- выдает все еще же ту ошибку надо сделать так чтобы только эттот код использовался без посторониих - поэтому пишем ' OR true-- это позволило залогиниться по пользователем admin@juice-sh.op. Предположим, что это администратор.
<img width="1919" height="1079" alt="image" src="https://github.com/user-attachments/assets/d4f76f91-4410-416b-b04d-c1c686324b0d" />
<img width="1919" height="1079" alt="image" src="https://github.com/user-attachments/assets/6c419be2-96aa-44e8-a0dd-610cc107957e" />


## Ответы на вопросы
### 1. Что такое SQL-инъекция?

**SQL-инъекция** — это одна из самых распространенных и опасных уязвимостей веб-приложений. Она возникает, когда злоумышленник может вставить произвольный SQL-код в запросы, которые приложение отправляет в базу данных. Это когда данные пользователя (например, введенные в форму логина) не проверяются и не обрабатываются должным образом, и приложение ошибочно выполняет их как часть команды SQL, а не как простые данные.

### 2. Почему ввод строки `' or 1=1;--` позволил войти в аккаунт администратора?

*   `username = 'admin' AND password = ''` — эта часть проверяет, совпадает ли пароль с пустой строкой. Обычно это `false`.
*   **`or 1=1`** — это ключевой момент. Логический оператор `OR` работает так: если любая из частей условия истинна, то всё условие истинно. `1=1` — это всегда истина. Таким образом, условие превращается в: `(false) OR (true)`, что в результате дает `true`.
*   **`;--`** — в SQL точка с запятой `;` означает конец команды, а двойной дефис `--` — это начало комментария. Всё, что следует после `--`, игнорируется базой данных. В нашем примере он "закомментировал" оставшуюся закрывающую кавычку `'`, чтобы не было синтаксической ошибки.

**Итоговый эффект:** Запрос преобразуется в:
```sql
SELECT * FROM users WHERE username = 'admin' AND password = '' or 1=1
```
А так как `1=1` всегда истинно, условие `WHERE` выполняется для **всех записей** в таблице `users`. База данных находит первую же запись (часто это запись администратора, идущая первой) и возвращает ее приложению. Приложение видит, что пользователь найден, и пропускает его в систему.

### 3. Как защитить web-ресурс от подобного рода атак?
Использование параметризованных запросов (Prepared Statements)
Использование ORM (Object-Relational Mapping)
Экранирование специальных символов
Принцип наименьших привилегий
Настройте пользователя, от имени которого ваше приложение подключается к базе данных, так, чтобы у него были **минимально необходимые** права. 
Регулярное тестирование на безопасность

## Задание 2. Узнайте пароль администратора

Почта: admin@juice-sh.op

Находясь после SQL под логином администратора - включаем DevTools и обновляем страницу OWAS Juice. Переходим в запрос домена - и находим заголовок кукис. Находим IDTOKEN
<img width="1919" height="1079" alt="image" src="https://github.com/user-attachments/assets/b3996dd9-c677-4beb-9f40-d15418800f15" />

Копируем его Декодируем онлайн с помощью ИИ. Получаем результат:
<img width="1919" height="1079" alt="image" src="https://github.com/user-attachments/assets/f7fb1d27-1037-409e-81e7-1020c0751f89" />

 Хэш "password": "0192023a7bbd73250516f069df18b500". Атака на него даже с помощью онлайн крэкера позволяет узнать строку пароля - admin123:

<img width="1881" height="1052" alt="image" src="https://github.com/user-attachments/assets/8b7f5ba4-7669-4844-a862-dd340b9f02bd" />

Пароль: admin123

Исходя из анализа кода
Ключевые поля:
* status: статус операции — «успешно».
* data: объект с данными пользователя:
* id: 1 (идентификатор пользователя).
* email: admin@juice-sh.op (почта администратора).
* role: admin (роль — администратор).
* isActive: true (аккаунт активен).
* createdAt/updatedAt: дата создания/обновления аккаунта.
* iat (issued at): время выдачи токена в формате Unix‑времени.

Проверяем: 
<img width="2880" height="1620" alt="image" src="https://github.com/user-attachments/assets/9d1b50e9-c027-4702-a4da-2df72c17cc5b" />
<img width="2880" height="1620" alt="image" src="https://github.com/user-attachments/assets/17693b3b-5db2-40c7-bd9e-2b65653009db" />

## Ответы на вопросы
### 1. Какой логин у администратора?
admin@juice-sh.op
### 2. Какой хэш пароля у администратора? 
Хэш "password": "0192023a7bbd73250516f069df18b500"
### 3. Какой пароль администратора?
Пароль: admin123
### 4. Что такое cookie?
**Cookie — это небольшие текстовые файлы, которые веб-сайты сохраняют в вашем браузере для запоминания информации о вас.** Они позволяют сайтам узнавать вас при повторных посещениях и сохранять данные like логин, настройки или содержимое корзины покупок. Без cookie сайты не могли бы запомнить, что вы уже вошли в аккаунт, и вам пришлось бы авторизоваться заново при каждом переходе на новую страницу.
### 5. Какие меры могут быть использованы для устранения выявленной уязвимости?
Для устранения уязвимости, необходимо немедленно исключить любые чувствительные данные (включая хэши паролей) из полезной нагрузки JWT, оставив только минимальные идентификаторы (например, userId и роль), реализовать короткое время жизни токенов в сочетании с системой безопасного обновления через refresh-токены, хранящиеся в защищенных куках с флагами HttpOnly, Secure и SameSite=Strict, использовать асимметричные алгоритмы подписи (например, RS256), регулярно проводить ротацию ключей подписи и обеспечивать строгую валидацию токенов на стороне сервера перед предоставлением доступа к любым ресурсам.
